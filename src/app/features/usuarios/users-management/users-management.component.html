<main class="px-4 sm:px-6 lg:px-8 py-8 flex flex-1 justify-center bg-white">
  <div class="flex flex-col w-full max-w-7xl gap-6">

    <!-- Título + botón -->
    <div class="flex flex-wrap items-center justify-between gap-4">
      <!-- Título -->
      <div class="flex flex-col gap-1">
        <p class="text-slate-900 text-3xl font-black leading-tight">Gestión de Usuarios</p>
        <p class="text-slate-500 text-base">Añade, edita, elimina y gestiona los usuarios del sistema.</p>
      </div>

      <!-- Botones agrupados -->
      <div class="flex gap-2">

        <!-- Botón Añadir Usuario -->
        <button
          [routerLink]="['/dashboard/usuarios/crear']"
          class="flex items-center gap-2 h-10 px-4 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
               stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Añadir Usuario
        </button>

        <!-- Botón Atender Solicitudes -->
        <button
          class="flex items-center gap-2 h-10 px-4 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
               stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
          Atender Solicitudes
        </button>

      </div>
    </div>

    <!-- Buscador + filtros -->
    <div class="flex flex-col lg:flex-row gap-4 items-center">

      <!-- Input búsqueda -->
      <div class="flex-grow">
        <label class="flex flex-col h-12 w-full">
          <div class="flex w-full h-full rounded-lg border border-slate-200 items-center">

            <!-- Ícono lupa -->
            <div class="flex items-center justify-center px-3">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                   stroke-width="2" stroke="currentColor" class="w-5 h-5 text-slate-500">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M21 21l-4.35-4.35M11 6.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z" />
              </svg>
            </div>

            <!-- Input -->
            <input type="text"
                   placeholder="Buscar por nombre, email o rol..."
                   class="flex-grow h-full px-2 text-base placeholder:text-slate-500 focus:outline-none"
                   [(ngModel)]="searchTerm"
                   (input)="applyFilter()">

          </div>
        </label>
      </div>


      <!-- Botón filtros -->
      <div class="relative">
        <button class="flex items-center gap-2 h-12 px-3 bg-white border border-slate-200 rounded-lg hover:bg-slate-50"
                (click)="toggleFilterDropdown()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
               stroke-width="2" stroke="currentColor" class="w-6 h-6 text-slate-800">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M3 4.5h18M6.75 9.75h10.5M10.5 15h3" />
          </svg>
          <span class="text-sm font-semibold">Filtros</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
               stroke-width="2" stroke="currentColor" class="w-4 h-4 ml-1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <!-- Dropdown filtros -->
        <div *ngIf="showFilterDropdown"
             class="absolute right-0 mt-2 w-48 bg-white border border-slate-200 rounded-lg shadow-lg z-50 p-2">
          <div class="flex flex-col gap-2">
            <label class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="filterRolAdmin"> Administrador
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="filterRolUsuario"> Usuario
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="filterActivo"> Activo
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="filterInactivo"> Inactivo
            </label>
            <button class="mt-2 bg-blue-600 text-white rounded-lg px-2 py-1 text-sm"
                    (click)="applyAdvancedFilter()">Aplicar</button>
          </div>
        </div>
      </div>

      <!-- Botón limpiar -->
      <button aria-label="Limpiar" title="Limpiar"
              class="flex items-center justify-center h-12 w-12 bg-white border border-slate-200 rounded-lg hover:bg-slate-50"
              (click)="clearFilter()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
             stroke-width="2" stroke="currentColor" class="w-6 h-6 text-slate-800" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

    </div>



    <!-- Tabla -->
    <div class="overflow-hidden rounded-xl border border-slate-200 bg-white">
      <table class="w-full text-sm text-left text-slate-500">
        <thead class="text-xs text-slate-700 uppercase bg-slate-50">
        <tr>
          <th class="p-4"><input type="checkbox" class="h-4 w-4"></th>
          <th class="px-6 py-3 font-medium">Nombre de Usuario</th>
          <th class="px-6 py-3 font-medium">Email</th>
          <th class="px-6 py-3 font-medium">Rol</th>
          <th class="px-6 py-3 font-medium">Fecha de alta</th>
          <th class="px-6 py-3 font-medium">Estado</th>
          <th class="px-6 py-3 font-medium text-right">Acciones</th>
        </tr>
        </thead>

        <tbody>


        <tr *ngFor="let user of paginatedUsers " class="border-b hover:bg-slate-50">

        <!-- Checkbox -->
          <td class="p-4">
            <input
              type="checkbox"
              class="h-4 w-4"
              [checked]="selectedUsers.includes(user.usuario_id)"
              (change)="toggleSelection(user.usuario_id)"
            >
          </td>

          <!-- Nombre -->
          <td class="px-6 py-4 font-semibold text-slate-900">
            {{ user.nombre }}
          </td>

          <!-- Email -->
          <td class="px-6 py-4">
            {{ user.email }}
          </td>

          <!-- Rol -->
          <td class="px-6 py-4">
      <span class="px-2.5 py-1 text-xs font-semibold rounded-full"
            [ngClass]="{
              'bg-red-100 text-red-600': user.rol?.nombre === 'Administrador',
              'bg-blue-100 text-blue-600': user.rol?.nombre === 'Usuario',
              'bg-slate-100 text-slate-600': !user.rol
            }">
        {{ user.rol?.nombre || 'SIN ROL' }}
      </span>
          </td>

          <!-- Fecha -->
          <td class="px-6 py-4">
            {{ user.created_at | date:'dd/MM/yyyy' }}
          </td>

          <!-- Estado -->
          <td class="px-6 py-4">
      <span class="inline-flex items-center gap-1.5 text-xs font-semibold">
        <span class="w-2 h-2 rounded-full"
              [ngClass]="user.activo ? 'bg-green-500' : 'bg-red-500'">
        </span>
        {{ user.activo ? 'Activo' : 'Inactivo' }}
      </span>
          </td>

          <!-- Acciones -->
          <td class="px-6 py-4 text-right flex justify-end gap-2">

            <!-- Editar -->
            <button class="p-2 text-slate-500 hover:text-primary"
                    (click)="editUser(user.usuario_id)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                   class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M16.862 4.487a2.25 2.25 0 1 1 3.182 3.183L7.5 20.214 3 21l.786-4.5L16.862 4.487Z" />
              </svg>
            </button>

            <!-- Borrar -->
            <button class="p-2 text-slate-500 hover:text-red-600"
                    (click)="deleteUser(user.usuario_id)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                   class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M6 7h12m-1.5 0-.5 12H7l-.5-12m4-3h3m-6 0h9" />
              </svg>
            </button>

          </td>
        </tr>

        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <nav class="flex flex-col md:flex-row justify-between items-center px-4 py-4">
      <!-- Texto de resultados -->
      <span class="text-sm text-slate-500 mb-2 md:mb-0">
  Mostrando
  <span class="font-semibold text-slate-900">
    {{ filteredUsers.length > 0 ? ((currentPage - 1) * pageSize + 1) : 0 }}-
    {{ filteredUsers.length > 0 ? Math.min(currentPage * pageSize, filteredUsers.length) : 0 }}
  </span>
  de
  <span class="font-semibold text-slate-900">{{ filteredUsers.length }}</span>
</span>
      <!-- Botones de paginación -->
      <ul class="inline-flex items-center -space-x-px">
        <!-- Prev -->
        <li>
          <button
            class="flex items-center justify-center px-3 py-2 bg-white border border-slate-300 rounded-l-lg text-slate-500 hover:bg-slate-100 disabled:opacity-50"
            [disabled]="currentPage === 1"
            (click)="goToPage(currentPage - 1)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke-width="2" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.75 19.5l-7.5-7.5 7.5-7.5" />
            </svg>
          </button>
        </li>

        <!-- Páginas dinámicas -->
        <li *ngFor="let page of pages">
          <button
            class="px-3 py-2 border border-slate-300 hover:bg-slate-100 text-sm font-medium"
            [ngClass]="{
          'bg-primary/10 border-primary text-primary': page === currentPage,
          'bg-white text-slate-700': page !== currentPage
        }"
            (click)="goToPage(page)">
            {{ page }}
          </button>
        </li>

        <!-- Next -->
        <li>
          <button
            class="flex items-center justify-center px-3 py-2 bg-white border border-slate-300 rounded-r-lg text-slate-500 hover:bg-slate-100 disabled:opacity-50"
            [disabled]="currentPage === totalPages"
            (click)="goToPage(currentPage + 1)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke-width="2" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>
        </li>
      </ul>
    </nav>

  </div>
</main>
